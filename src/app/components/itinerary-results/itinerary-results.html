<section
  id="itinerary-results"
  class="results-section py-20 bg-gray-50"
  role="region"
  aria-labelledby="itinerary-heading"
  aria-live="polite"
>
  <div class="container max-w-6xl no-print">
    <div class="results-grid grid grid-cols-1 lg:grid-cols-12 gap-10">
      <!-- Left: Top Flight Deals -->
      <div class="flight-deals-column lg:col-span-5">
        <div class="column-header mb-8 flex items-center justify-between">
          <h2 class="text-ui text-2xl font-bold flex items-center gap-4">
            <span class="material-icons text-accent">flight_takeoff</span>
            Top Flight Deals
          </h2>
        </div>

        <div class="space-y-4">
          @if (itinerary()?.flightOptions; as flights) {
            @for (flight of flights; track flight.googleFlightsUrl) {
              <div class="flight-deal-card">
                <div class="flight-info">
                  <div class="airline">{{ flight.title }}</div>
                  <div class="route">{{ flight.description }}</div>
                  <a
                    [href]="flight.googleFlightsUrl"
                    target="_blank"
                    rel="noopener"
                    class="text-accent text-sm font-semibold mt-4 inline-flex items-center gap-2 hover:underline"
                  >
                    View on Google Flights
                    <span class="material-icons text-xs">open_in_new</span>
                  </a>
                </div>
                <div class="flight-price">
                  <span class="label">From</span>
                  @if (flight.priceKsh && flight.priceUsd) {
                    <span class="price">
                      KSh {{ flight.priceKsh | number }} ({{ flight.priceUsd | currency: 'USD':'symbol':'1.0-0' }})
                    </span>
                  } @else {
                    <span class="price">$1,240</span>
                  }
                </div>
              </div>
            } @empty {
              <div class="text-center py-12 bg-white rounded-xl shadow-sm border border-gray-100">
                <span class="material-icons text-4xl text-gray-300">flight_takeoff</span>
                <p class="text-gray-500 mt-2 font-medium">No specific flight deals found.</p>
              </div>
            }
          }
        </div>

        <div class="price-insights mt-8 bg-blue-50 p-6 rounded-2xl border border-blue-100 shadow-sm">
          <h4 class="font-bold text-blue-900 flex items-center gap-3 mb-2">
            <span class="material-icons text-blue-600">insights</span>
            Price Insights
          </h4>
          <p class="text-sm text-blue-800 leading-relaxed">
            Prices are currently low for {{ destination() }}. This is a great time to book! We
            recommend booking within the next 14 days for the best rates.
          </p>
        </div>
      </div>

      <!-- Right: Genie's Suggested Itinerary -->
      <div class="itinerary-column lg:col-span-7">
        <div class="column-header mb-8 no-print flex items-center justify-between">
          <h2 class="text-ui text-2xl font-bold flex items-center gap-4">
            <span class="material-icons text-secondary">auto_awesome</span>
            Genie's Suggested Itinerary
          </h2>

          <button
            (click)="onToggleWishlist()"
            class="wishlist-btn"
            [class.is-saved]="isSaved()"
            [disabled]="isSaving()"
            [attr.aria-label]="isSaved() ? 'Remove from wishlist' : 'Save to wishlist'"
          >
            @if (isSaving()) {
              <span class="material-icons animate-spin">refresh</span>
            } @else {
              <span class="material-icons">{{ isSaved() ? 'favorite' : 'favorite_border' }}</span>
            }
          </button>
        </div>

        <div class="itinerary-container shadow-sm no-print">
          <div class="prose" [innerHTML]="itinerary()?.htmlContent"></div>

          <div class="itinerary-footer mt-10 pt-8 border-t border-gray-100 flex flex-wrap gap-4 no-print">
            <button (click)="printItinerary.emit()" class="btn btn-primary rounded-full flex items-center gap-2">
              <span class="material-icons">download</span>
              Save Itinerary
            </button>
            @if (false) {
              <button class="btn btn-secondary rounded-full flex items-center gap-2">
                <span class="material-icons">share</span>
                Share Trip
              </button>
            }
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Print-only view of the itinerary -->
  <div class="print-only hidden">
    <div class="print-header">
      <div class="flex justify-between items-start w-full mb-8 border-b-2 border-gray-100 pb-6">
        <div>
          <h1 class="text-ui text-3xl font-bold text-primary">Travel Itinerary</h1>
          @if (destination()) {
            <p class="text-gray-600 mt-1 font-semibold">Destination: {{ destination() }}</p>
          }
          <p class="text-gray-500 mt-1">Generated by Wander Genie</p>
        </div>
        <div class="text-right">
          <h2 class="text-brand text-2xl">
            Wander<span class="text-secondary">Genie</span>
          </h2>
        </div>
      </div>
    </div>
    <div class="prose max-w-none" [innerHTML]="itinerary()?.htmlContent"></div>

    <div class="mt-12 pt-8 border-t border-gray-100 text-center text-sm text-gray-400">
      <p>Visit wander-genie.web.app to plan your next adventure</p>
    </div>
  </div>
</section>
